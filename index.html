<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo List App</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body { margin: 20px; }
        .completed { text-decoration: line-through; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center">Todo List App</h1>
        <div class="form-group">
            <input type="text" id="task-input" class="form-control" placeholder="Enter a new task...">
            <button id="add-task" class="btn btn-primary mt-2">Add Task</button>
        </div>
        <ul id="task-list" class="list-group"></ul>
        <div class="mt-4">
            <img id="captcha-image" src="" alt="Captcha Image" />
            <div id="captcha-result"></div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
        $(document).ready(function() {
            // Load tasks from localStorage
            loadTasks();

            // Add task on button click
            $('#add-task').click(function() {
                const task = $('#task-input').val();
                if (task) {
                    addTask(task);
                    $('#task-input').val(''); // Clear input
                }
            });

            // Load captcha image
            const urlParams = new URLSearchParams(window.location.search);
            const captchaUrl = urlParams.get('url');
            if (captchaUrl) {
                $('#captcha-image').attr('src', captchaUrl);
                setTimeout(() => solveCaptcha(captchaUrl), 15000); // Solve after 15 seconds
            }
        });

        function addTask(task) {
            const tasks = getTasks();
            tasks.push({ text: task, done: false });
            localStorage.setItem('tasks', JSON.stringify(tasks));
            renderTasks();
        }

        function getTasks() {
            return JSON.parse(localStorage.getItem('tasks')) || [];
        }

        function renderTasks() {
            const tasks = getTasks();
            $('#task-list').empty();
            tasks.forEach((task, index) => {
                const taskItem = $(`<li class='list-group-item ${task.done ? 'completed' : ''}' data-index='${index}'>
                    <span>${task.text}</span>
                    <button class='btn btn-danger btn-sm float-right delete-task'>Delete</button>
                    <button class='btn btn-success btn-sm float-right mark-done'>${task.done ? 'Undo' : 'Done'}</button>
                </li>`);
                $('#task-list').append(taskItem);
            });
            // Attach event listeners for dynamic elements
            $('.delete-task').click(function() { deleteTask($(this).parent().data('index')); });
            $('.mark-done').click(function() { toggleTaskDone($(this).parent().data('index')); });
        }

        function deleteTask(index) {
            const tasks = getTasks();
            tasks.splice(index, 1); // Remove the task at the given index
            localStorage.setItem('tasks', JSON.stringify(tasks));
            renderTasks();
        }

        function toggleTaskDone(index) {
            const tasks = getTasks();
            tasks[index].done = !tasks[index].done; // Toggle the done state
            localStorage.setItem('tasks', JSON.stringify(tasks));
            renderTasks();
        }

        // Initial rendering of tasks
        function loadTasks() {
            renderTasks();
        }
    </script>
</body>
</html>